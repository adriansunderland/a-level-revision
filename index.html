<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Charlotte's A-Level Revision App</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); min-height: 100vh; padding: 20px; }
        .container { max-width: 900px; margin: 0 auto; }
        header { text-align: center; color: white; margin-bottom: 30px; }
        header h1 { font-size: 2.2em; margin-bottom: 10px; text-shadow: 2px 2px 4px rgba(0,0,0,0.2); }
        header p { opacity: 0.9; font-size: 1.1em; }
        .card { background: white; border-radius: 16px; padding: 25px; margin-bottom: 20px; box-shadow: 0 10px 40px rgba(0,0,0,0.2); }
        .subject-selector { display: flex; gap: 10px; flex-wrap: wrap; margin-bottom: 20px; }
        .subject-btn { padding: 12px 24px; border: none; border-radius: 25px; cursor: pointer; font-size: 1em; font-weight: 600; transition: all 0.3s ease; }
        .subject-btn.psychology { background: linear-gradient(135deg, #FF9800, #F57C00); color: white; }
        .subject-btn.pe { background: linear-gradient(135deg, #f44336, #c62828); color: white; }
        .subject-btn.english { background: linear-gradient(135deg, #4CAF50, #2E7D32); color: white; }
        .subject-btn:hover { transform: translateY(-2px); box-shadow: 0 5px 20px rgba(0,0,0,0.2); }
        .subject-btn.active { box-shadow: 0 0 0 4px rgba(255,255,255,0.5); }
        .topic-selector { margin-bottom: 20px; }
        .topic-selector select { width: 100%; padding: 12px; border: 2px solid #e0e0e0; border-radius: 8px; font-size: 1em; cursor: pointer; }
        .question-box { background: #f8f9fa; border-left: 4px solid #667eea; padding: 20px; border-radius: 0 8px 8px 0; margin-bottom: 20px; }
        .question-meta { display: flex; gap: 10px; margin-bottom: 10px; flex-wrap: wrap; }
        .question-box .marks { display: inline-block; background: #667eea; color: white; padding: 4px 12px; border-radius: 12px; font-size: 0.85em; }
        .question-box .paper-tag { display: inline-block; background: #e0e0e0; color: #333; padding: 4px 12px; border-radius: 12px; font-size: 0.85em; }
        .question-box .question-text { font-size: 1.1em; line-height: 1.6; color: #333; }
        .answer-area { margin-bottom: 20px; }
        .answer-area label { display: block; font-weight: 600; margin-bottom: 8px; color: #333; }
        .answer-area textarea { width: 100%; min-height: 200px; padding: 15px; border: 2px solid #e0e0e0; border-radius: 8px; font-size: 1em; line-height: 1.6; resize: vertical; transition: border-color 0.3s; }
        .answer-area textarea:focus { outline: none; border-color: #667eea; }
        .word-count { text-align: right; color: #666; font-size: 0.9em; margin-top: 5px; }
        .btn-primary { background: linear-gradient(135deg, #667eea, #764ba2); color: white; border: none; padding: 15px 40px; border-radius: 25px; font-size: 1.1em; font-weight: 600; cursor: pointer; transition: all 0.3s ease; display: block; width: 100%; }
        .btn-primary:hover { transform: translateY(-2px); box-shadow: 0 5px 20px rgba(102, 126, 234, 0.4); }
        .btn-secondary { background: #f0f0f0; color: #333; border: none; padding: 12px 30px; border-radius: 25px; font-size: 1em; cursor: pointer; transition: all 0.3s ease; margin-top: 10px; }
        .btn-secondary:hover { background: #e0e0e0; }
        .feedback-section { display: none; }
        .feedback-section.visible { display: block; }
        .mark-display { text-align: center; padding: 20px; background: linear-gradient(135deg, #667eea, #764ba2); border-radius: 12px; color: white; margin-bottom: 20px; }
        .mark-display .mark { font-size: 3em; font-weight: bold; }
        .mark-display .mark-label { font-size: 1.1em; opacity: 0.9; }
        .grade-indicator { display: inline-block; padding: 5px 15px; border-radius: 20px; font-weight: bold; margin-top: 10px; }
        .grade-a { background: #4CAF50; } .grade-b { background: #8BC34A; } .grade-c { background: #FFC107; color: #333; } .grade-d { background: #FF9800; } .grade-e { background: #f44336; }
        .feedback-box { background: #f8f9fa; border-radius: 8px; padding: 20px; margin-bottom: 15px; }
        .feedback-box h3 { color: #333; margin-bottom: 10px; }
        .feedback-box.strengths { border-left: 4px solid #4CAF50; }
        .feedback-box.improvements { border-left: 4px solid #FF9800; }
        .feedback-box.model-points { border-left: 4px solid #2196F3; }
        .feedback-box ul { margin-left: 20px; line-height: 1.8; }
        .loading { text-align: center; padding: 40px; }
        .loading .spinner { width: 50px; height: 50px; border: 4px solid #f3f3f3; border-top: 4px solid #667eea; border-radius: 50%; animation: spin 1s linear infinite; margin: 0 auto 20px; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        .stats-bar { display: flex; gap: 15px; flex-wrap: wrap; margin-bottom: 20px; }
        .stat-item { background: #f8f9fa; padding: 15px 20px; border-radius: 8px; text-align: center; flex: 1; min-width: 80px; }
        .stat-item .stat-value { font-size: 1.5em; font-weight: bold; color: #667eea; }
        .stat-item .stat-label { font-size: 0.75em; color: #666; }
        .hidden { display: none; }
        .mark-scheme-toggle { background: #e8f4fd; border: 1px solid #90caf9; border-radius: 8px; padding: 15px; margin-top: 15px; }
        .mark-scheme-toggle summary { font-weight: 600; color: #1976D2; cursor: pointer; }
        .mark-scheme-content { margin-top: 10px; padding-top: 10px; border-top: 1px solid #90caf9; font-size: 0.95em; line-height: 1.6; }
        .api-key-section { background: #fff3e0; border: 1px solid #ffcc80; border-radius: 8px; padding: 15px; margin-bottom: 20px; }
        .api-key-section input { width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 4px; margin-top: 8px; font-family: monospace; }
        .api-key-section small { color: #666; display: block; margin-top: 8px; }
        .nav-tabs { display: flex; gap: 5px; margin-bottom: 20px; border-bottom: 2px solid #e0e0e0; }
        .nav-tab { padding: 12px 24px; border: none; background: none; cursor: pointer; font-size: 1em; font-weight: 600; color: #666; border-bottom: 3px solid transparent; margin-bottom: -2px; transition: all 0.3s; }
        .nav-tab:hover { color: #667eea; }
        .nav-tab.active { color: #667eea; border-bottom-color: #667eea; }
        .progress-section { display: none; }
        .progress-section.visible { display: block; }
        .summary-cards { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 20px; }
        .summary-card { background: linear-gradient(135deg, #667eea, #764ba2); color: white; padding: 20px; border-radius: 12px; text-align: center; }
        .summary-card.psychology { background: linear-gradient(135deg, #FF9800, #F57C00); }
        .summary-card.pe { background: linear-gradient(135deg, #f44336, #c62828); }
        .summary-card.english { background: linear-gradient(135deg, #4CAF50, #2E7D32); }
        .summary-card .card-value { font-size: 2em; font-weight: bold; }
        .summary-card .card-label { font-size: 0.9em; opacity: 0.9; }
        .trend-indicator { font-size: 0.8em; margin-top: 5px; }
        .trend-up { color: #90EE90; }
        .trend-down { color: #FFB6C1; }
        .chart-container { background: #f8f9fa; border-radius: 8px; padding: 20px; margin-bottom: 20px; }
        .weekly-chart { display: flex; align-items: flex-end; justify-content: space-between; height: 150px; padding: 10px 0; }
        .chart-bar { flex: 1; margin: 0 3px; background: linear-gradient(to top, #667eea, #764ba2); border-radius: 4px 4px 0 0; min-width: 30px; position: relative; transition: all 0.3s; }
        .chart-bar-label { position: absolute; bottom: -25px; left: 50%; transform: translateX(-50%); font-size: 0.7em; color: #666; }
        .chart-bar-value { position: absolute; top: -20px; left: 50%; transform: translateX(-50%); font-size: 0.75em; font-weight: bold; color: #667eea; }
        .history-table { width: 100%; border-collapse: collapse; font-size: 0.9em; }
        .history-table th, .history-table td { padding: 12px; text-align: left; border-bottom: 1px solid #e0e0e0; }
        .history-table th { background: #667eea; color: white; }
        .history-table tr:hover { background: #f5f5f5; }
        .score-good { color: #4CAF50; font-weight: bold; }
        .score-ok { color: #FF9800; font-weight: bold; }
        .score-low { color: #f44336; font-weight: bold; }
        .topic-row { display: flex; align-items: center; padding: 10px 0; border-bottom: 1px solid #eee; }
        .topic-name { flex: 1; font-weight: 500; }
        .topic-bar-container { flex: 2; background: #e0e0e0; border-radius: 10px; height: 20px; margin: 0 15px; overflow: hidden; }
        .topic-bar { height: 100%; border-radius: 10px; }
        .topic-bar.good { background: linear-gradient(90deg, #4CAF50, #8BC34A); }
        .topic-bar.ok { background: linear-gradient(90deg, #FF9800, #FFC107); }
        .topic-bar.low { background: linear-gradient(90deg, #f44336, #ff7043); }
        .topic-score { width: 60px; text-align: right; font-weight: bold; }
        .no-data { text-align: center; padding: 40px; color: #666; }
        .export-btn { background: #4CAF50; color: white; border: none; padding: 10px 20px; border-radius: 8px; cursor: pointer; margin-top: 15px; }
        @media (max-width: 600px) { .subject-selector, .stats-bar { flex-direction: column; } .subject-btn { width: 100%; } header h1 { font-size: 1.6em; } .nav-tab { padding: 10px 15px; font-size: 0.9em; } .summary-cards { grid-template-columns: 1fr; } }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>üéì Charlotte's A-Level Revision</h1>
            <p>160+ practice questions with AI marking & progress tracking</p>
        </header>
        <div class="card">
            <div class="nav-tabs">
                <button class="nav-tab active" onclick="showTab('practice')">üìù Practice</button>
                <button class="nav-tab" onclick="showTab('progress')">üìä Progress</button>
            </div>
            <div id="practiceTab">
                <div class="stats-bar">
                    <div class="stat-item"><div class="stat-value" id="questionsToday">0</div><div class="stat-label">Today</div></div>
                    <div class="stat-item"><div class="stat-value" id="questionsTotal">0</div><div class="stat-label">Total</div></div>
                    <div class="stat-item"><div class="stat-value" id="averageMark">-</div><div class="stat-label">Average</div></div>
                    <div class="stat-item"><div class="stat-value" id="streak">0</div><div class="stat-label">Streak üî•</div></div>
                    <div class="stat-item"><div class="stat-value" id="totalQuestions">160+</div><div class="stat-label">Questions</div></div>
                </div>
            </div>
            <div id="progressTab" class="progress-section">
                <div class="summary-cards">
                    <div class="summary-card psychology"><div class="card-value" id="psychAvg">-</div><div class="card-label">Psychology</div><div class="trend-indicator" id="psychTrend"></div></div>
                    <div class="summary-card pe"><div class="card-value" id="peAvg">-</div><div class="card-label">PE</div><div class="trend-indicator" id="peTrend"></div></div>
                    <div class="summary-card english"><div class="card-value" id="engAvg">-</div><div class="card-label">English</div><div class="trend-indicator" id="engTrend"></div></div>
                </div>
                <div class="chart-container"><h3 style="margin-bottom:15px">üìà Last 7 Days</h3><div class="weekly-chart" id="weeklyChart"></div></div>
                <div class="chart-container"><h3 style="margin-bottom:15px">üìö Weakest Topics (focus here!)</h3><div id="topicBreakdown"></div></div>
                <div class="chart-container"><h3 style="margin-bottom:15px">üìã Recent Sessions</h3><div id="historyTable"></div><button class="export-btn" onclick="exportData()">üì• Export CSV</button></div>
            </div>
        </div>
        <div class="card api-key-section" id="apiKeySection">
            <h3>üîë Claude API Key (Optional)</h3>
            <p style="margin-top:10px;font-size:0.95em">For AI marking, add your key from <a href="https://console.anthropic.com/" target="_blank">console.anthropic.com</a></p>
            <input type="password" id="apiKey" placeholder="sk-ant-...">
            <small>Stored locally only.</small>
            <button class="btn-secondary" onclick="saveApiKey()" style="margin-top:10px">Save Key</button>
        </div>
        <div class="card" id="questionSection">
            <h2 style="margin-bottom:20px">üìù Practice Question</h2>
            <div class="subject-selector">
                <button class="subject-btn psychology active" onclick="selectSubject('psychology')">Psychology</button>
                <button class="subject-btn pe" onclick="selectSubject('pe')">PE</button>
                <button class="subject-btn english" onclick="selectSubject('english')">English</button>
            </div>
            <div class="topic-selector"><select id="topicSelect" onchange="loadQuestion()"><option value="">Select a topic...</option></select></div>
            <div class="question-box">
                <div class="question-meta"><span class="marks" id="questionMarks">[4 marks]</span><span class="paper-tag" id="paperTag">Component 1</span></div>
                <p class="question-text" id="questionText">Select a subject and topic to begin...</p>
            </div>
            <div class="answer-area">
                <label>Your Answer:</label>
                <textarea id="answerInput" placeholder="Type your answer here..."></textarea>
                <div class="word-count"><span id="wordCount">0</span> words</div>
            </div>
            <button class="btn-primary" onclick="submitAnswer()">‚ú® Mark My Answer</button>
            <button class="btn-secondary" onclick="loadQuestion()" style="width:100%">Skip ‚Üí Next Question</button>
        </div>
        <div class="card hidden" id="loadingSection"><div class="loading"><div class="spinner"></div><p>Analysing your answer...</p></div></div>
        <div class="card feedback-section" id="feedbackSection">
            <div class="mark-display"><div class="mark"><span id="markAwarded">0</span>/<span id="markTotal">4</span></div><div class="mark-label">marks awarded</div><div class="grade-indicator" id="gradeIndicator">Grade A</div></div>
            <div class="feedback-box strengths"><h3>‚úÖ What You Did Well</h3><div id="strengthsFeedback"></div></div>
            <div class="feedback-box improvements"><h3>üéØ How To Improve</h3><div id="improvementsFeedback"></div></div>
            <div class="feedback-box model-points"><h3>üí° Key Points</h3><div id="modelPointsFeedback"></div></div>
            <details class="mark-scheme-toggle"><summary>üìã Mark Scheme & Model Answer</summary><div class="mark-scheme-content" id="markSchemeContent"></div></details>
            <button class="btn-primary" onclick="nextQuestion()" style="margin-top:20px">Next Question ‚Üí</button>
        </div>
    </div>
<script>
const Q={psychology:{'Biological Approach':[
{q:"Outline two assumptions of the biological approach.",m:4,p:"C1",ms:"2 marks per assumption with elaboration",ma:"1) Behaviour has genetic basis - inherited through genes. Twin studies show higher concordance in MZ twins. 2) Neurochemistry affects behaviour - neurotransmitters like serotonin regulate mood."},
{q:"Explain one strength and one weakness of drug therapy.",m:4,p:"C1",ms:"2 marks per point with evidence",ma:"Strength: Research support - Kirsch et al meta-analysis showed SSRIs effective for severe depression. Weakness: Side effects including nausea, weight gain, suicidal thoughts."},
{q:"Evaluate the biological approach.",m:8,p:"C1",ms:"2+ strengths and weaknesses with evidence",ma:"Strengths: Scientific methods (brain scans), practical applications. Weaknesses: Reductionist, deterministic. Unlike cognitive approach, focuses on biology not mental processes."},
{q:"Describe how genes influence behaviour.",m:4,p:"C1",ms:"Genetic transmission, evidence, link to behaviour",ma:"Genes are inherited DNA instructions affecting brain structure, neurotransmitters, hormones. Twin studies show higher concordance for MZ twins on traits like intelligence."},
{q:"Explain synaptic transmission.",m:4,p:"C1",ms:"Process description with terminology",ma:"Electrical impulse reaches axon terminal, triggers neurotransmitter release into synaptic cleft. Neurotransmitters bind to receptors on post-synaptic neuron."},
{q:"Explain how neurotransmitters affect behaviour.",m:6,p:"C1",ms:"Definition, mechanism, examples",ma:"Chemical messengers crossing synapses. Serotonin regulates mood (low=depression). Dopamine affects reward (excess=schizophrenia). Noradrenaline influences arousal."},
{q:"Describe and evaluate drug therapy.",m:12,p:"C1",ms:"AO1: mechanism, types. AO3: evidence, ethics",ma:"SSRIs block serotonin reuptake for depression. Antipsychotics block dopamine. Strengths: Research support, quick relief. Weaknesses: Side effects, treats symptoms not cause."},
{q:"Outline the fight-or-flight response.",m:4,p:"C1",ms:"Trigger, changes, purpose",ma:"Threat activates hypothalamus, sympathetic NS releases adrenaline. Increased HR, breathing, blood to muscles. Prepares body for action."},
{q:"Explain localisation of brain function.",m:6,p:"C1",ms:"Concept with specific areas",ma:"Different brain areas have specific functions. Broca's area: speech production. Wernicke's area: language comprehension. Prefrontal cortex: decision-making."},
{q:"Describe the structure and function of neurons.",m:6,p:"C1",ms:"Types, structure, function",ma:"Sensory neurons carry info to CNS, motor neurons to muscles, relay neurons connect them. Structure: dendrites receive, cell body processes, axon transmits, terminal buttons release neurotransmitters."}
],'Cognitive Approach':[
{q:"Outline two assumptions of the cognitive approach.",m:4,p:"C1",ms:"2 marks per assumption",ma:"1) Internal mental processes can be studied scientifically through inference. 2) Mind works like information processor with limitations like capacity constraints."},
{q:"Describe the main features of CBT.",m:4,p:"C1",ms:"Key features/stages",ma:"Identifies negative automatic thoughts via diaries. Challenges thoughts through Socratic questioning. Develops alternatives. Tests predictions through behavioural experiments."},
{q:"Evaluate CBT as a treatment.",m:6,p:"C1",ms:"Strengths and weaknesses with evidence",ma:"Strengths: NICE recommended, Butler et al meta-analysis showed large effects. Weaknesses: Requires motivation, time-consuming, may oversimplify."},
{q:"Explain what is meant by a schema.",m:4,p:"C1",ms:"Definition, development, effects",ma:"Mental framework built from experience helping process information quickly. Can cause biases like confirmation bias or negative schemas in depression."},
{q:"Describe Beck's cognitive theory of depression.",m:6,p:"C1",ms:"Negative triad, distortions, cycle",ma:"Depression from negative schemas. Negative triad: negative views of self, world, future. Cognitive distortions maintain depression."},
{q:"Evaluate the cognitive approach.",m:8,p:"C1",ms:"Balanced evaluation with comparison",ma:"Strengths: Scientific methods, successful applications (CBT). Weaknesses: Machine reductionism oversimplifies. Lab studies lack ecological validity."},
{q:"Compare cognitive and biological approaches.",m:8,p:"C1",ms:"Similarities and differences",ma:"Both scientific but cognitive uses inference, biological uses scans. Cognitive sees disorder as faulty thinking, biological as chemical imbalance."},
{q:"Explain cognitive distortions in mental disorder.",m:6,p:"C1",ms:"Definition, types, examples",ma:"Faulty thinking patterns. Overgeneralisation: one failure means always fail. Catastrophising: expecting worst. Personalisation: blaming self for external events."}
],'Behaviourist Approach':[
{q:"Outline two assumptions of behaviourism.",m:4,p:"C1",ms:"2 marks per assumption",ma:"1) All behaviour learned from environment - born blank slates. 2) Only observable behaviour should be studied to be scientific."},
{q:"Explain classical conditioning with example.",m:4,p:"C1",ms:"Process with terminology and example",ma:"Learning through association. Pavlov: Food (UCS) causes salivation (UCR). Bell (NS) paired with food. Bell alone (CS) causes salivation (CR)."},
{q:"Explain positive and negative reinforcement.",m:4,p:"C1",ms:"Definitions showing both increase behaviour",ma:"Both increase behaviour. Positive: adding pleasant - sweets for tidying. Negative: removing unpleasant - painkillers remove headache."},
{q:"Describe systematic desensitisation.",m:6,p:"C1",ms:"Basis, stages, mechanism",ma:"Counterconditioning for phobias. Create anxiety hierarchy. Learn relaxation. While relaxed, face feared stimulus progressively."},
{q:"Evaluate the behaviourist approach.",m:8,p:"C1",ms:"Balanced with evidence",ma:"Strengths: Scientific/objective, practical applications. Weaknesses: Deterministic, ignores cognition, animal research may not generalise."},
{q:"Describe operant conditioning.",m:6,p:"C1",ms:"Principles with examples",ma:"Learning from consequences. Positive reinforcement: reward increases behaviour. Negative reinforcement: removing unpleasant increases behaviour. Punishment decreases behaviour."},
{q:"Compare classical and operant conditioning.",m:4,p:"C1",ms:"Clear distinctions",ma:"Classical: associations between stimuli (involuntary). Operant: learning from consequences (voluntary). Classical is passive, operant active."},
{q:"Evaluate flooding as a therapy.",m:6,p:"C1",ms:"Description, strengths, weaknesses",ma:"Immediate exposure to most feared stimulus until fear extinguishes. Quick and effective but traumatic, high dropout, ethical concerns."}
],'Psychodynamic Approach':[
{q:"Outline two assumptions of psychodynamic approach.",m:4,p:"C1",ms:"2 marks per assumption",ma:"1) Unconscious mind influences behaviour. 2) Early childhood shapes adult personality through relationships with parents."},
{q:"Describe Freud's structure of personality.",m:6,p:"C1",ms:"Id, Ego, Superego",ma:"Id: pleasure principle, instant gratification. Ego: reality principle, mediates. Superego: morality principle, internalised standards."},
{q:"Explain two defence mechanisms.",m:4,p:"C1",ms:"2 marks per mechanism",ma:"Repression: pushing trauma to unconscious. Displacement: redirecting emotions to safer target. Both protect ego from anxiety."},
{q:"Evaluate the psychodynamic approach.",m:8,p:"C1",ms:"Balanced with evidence",ma:"Strengths: First to emphasise unconscious, influential. Weaknesses: Unfalsifiable, biased case studies, overemphasis on sexuality."},
{q:"Describe psychoanalysis.",m:6,p:"C1",ms:"Aim, techniques",ma:"Brings unconscious to awareness. Free association reveals links. Dream analysis interprets latent content. Interprets transference."},
{q:"Explain psychosexual stages.",m:6,p:"C1",ms:"Stages with fixation effects",ma:"Oral (0-1): feeding. Anal (1-3): toilet training. Phallic (3-5): Oedipus complex. Latency: dormant. Genital: mature sexuality."}
],'Positive Approach':[
{q:"Outline two assumptions of positive psychology.",m:4,p:"C1",ms:"2 marks per assumption",ma:"1) Focus on strengths and wellbeing, not disorders. 2) Wellbeing can be measured and improved through interventions."},
{q:"Describe the PERMA model.",m:5,p:"C1",ms:"All 5 components",ma:"Positive emotions, Engagement (flow), Relationships, Meaning (purpose), Achievement (mastery)."},
{q:"Evaluate positive psychology.",m:8,p:"C1",ms:"Balanced evaluation",ma:"Strengths: Focus on wellbeing, evidence-based interventions. Weaknesses: Western bias, may oversimplify happiness."},
{q:"Explain learned optimism.",m:4,p:"C1",ms:"Concept and benefits",ma:"Seligman: optimistic thinking can be learned. Optimists attribute failure externally. Benefits: better health, resilience."},
{q:"Describe a positive psychology intervention.",m:4,p:"C1",ms:"Intervention with evidence",ma:"Gratitude journal: writing 3 good things daily. Emmons & McCullough found increased wellbeing after 10 weeks."}
],'Research Methods':[
{q:"Explain reliability and validity.",m:4,p:"C2",ms:"Clear definitions",ma:"Reliability: consistency if repeated. Validity: measures what it claims. Can be reliable but not valid."},
{q:"Design a lab experiment on caffeine and reaction time.",m:6,p:"C2",ms:"Design, IV, DV, controls",ma:"Independent groups. IV: 200mg caffeine/placebo. DV: reaction time in ms. Random allocation. Standardise conditions. Informed consent."},
{q:"Explain strengths and weaknesses of lab experiments.",m:4,p:"C2",ms:"One of each",ma:"Strength: High control allows cause-effect. Weakness: Low ecological validity, artificial setting."},
{q:"What are demand characteristics?",m:4,p:"C2",ms:"Definition and effect",ma:"Cues revealing experiment purpose. Participants may act unnaturally. Threatens internal validity."},
{q:"Explain Type I and Type II errors.",m:4,p:"C2",ms:"Clear definitions",ma:"Type I: rejecting null when true (false positive). Type II: accepting null when false (false negative)."},
{q:"When use Mann-Whitney U test?",m:4,p:"C2",ms:"All conditions",ma:"Testing difference, independent groups, ordinal data or interval not meeting parametric assumptions."},
{q:"Explain purpose of pilot study.",m:3,p:"C2",ms:"Definition and purposes",ma:"Small-scale trial. Identifies problems with design. Refines study before full data collection."},
{q:"Interpret r=+0.82 correlation.",m:4,p:"C2",ms:"Interpretation and limitation",ma:"Strong positive correlation. Does NOT show causation - third variable possible."},
{q:"How improve observational reliability?",m:4,p:"C2",ms:"2 methods",ma:"Inter-rater reliability: multiple observers. Clear behavioural categories with operationalised definitions."},
{q:"Explain informed consent.",m:4,p:"C2",ms:"Definition and importance",ma:"Participants agree after being told purpose, procedures, rights. Respects autonomy, protects from harm."},
{q:"Describe sampling methods.",m:6,p:"C2",ms:"Methods with evaluation",ma:"Random: equal chance, unbiased but slow. Opportunity: whoever available, quick but biased. Stratified: proportional subgroups."},
{q:"What is operationalisation?",m:3,p:"C2",ms:"Definition with example",ma:"Defining variables in measurable terms. Stress operationalised as cortisol level or questionnaire score."},
{q:"Explain internal and external validity.",m:4,p:"C2",ms:"Definitions with examples",ma:"Internal: IV caused DV change. External: findings generalise to other settings/populations."},
{q:"Describe ethical guidelines.",m:6,p:"C2",ms:"Multiple guidelines",ma:"Informed consent, deception minimised, right to withdraw, protection from harm, confidentiality."},
{q:"When use Wilcoxon test?",m:3,p:"C2",ms:"Conditions for use",ma:"Testing difference, repeated measures design, ordinal data."}
],'Classic Studies':[
{q:"Describe Milgram's obedience study.",m:6,p:"C1",ms:"Aims, procedure",ma:"Aim: investigate obedience. 40 males shocked learner for wrong answers. Experimenter gave prods. 65% went to 450V."},
{q:"Evaluate Milgram's research.",m:8,p:"C1",ms:"Strengths and weaknesses",ma:"Strengths: High control, real-world relevance. Weaknesses: Ethical issues, low ecological validity, demand characteristics."},
{q:"Describe Bandura's Bobo doll study.",m:6,p:"C1",ms:"Aim, procedure, findings",ma:"Children observed aggressive/non-aggressive adult. Those seeing aggressive model imitated specific acts. Boys more aggressive."},
{q:"Evaluate Bandura's research.",m:6,p:"C1",ms:"Strengths and weaknesses",ma:"Strengths: Controlled, established social learning. Weaknesses: Artificial, demand characteristics, ethics with children."},
{q:"Describe Zimbardo's Stanford Prison Experiment.",m:6,p:"C1",ms:"Aim, procedure, events",ma:"Investigate conformity to roles. Students as prisoners/guards. Guards became brutal. Stopped after 6 days."},
{q:"Evaluate Stanford Prison Experiment.",m:6,p:"C1",ms:"Strengths and weaknesses",ma:"Strengths: Ecological validity, showed situational power. Weaknesses: Severe ethical issues, demand characteristics."},
{q:"Describe Ainsworth's Strange Situation.",m:4,p:"C1",ms:"Procedure stages",ma:"8 episodes observing infant-caregiver attachment. Stranger enters, caregiver leaves/returns. Measures separation/reunion behaviour."},
{q:"Outline attachment types from Ainsworth.",m:6,p:"C1",ms:"3 types with behaviours",ma:"Secure: distressed at separation, comforted on reunion (66%). Avoidant: unconcerned (22%). Resistant: very distressed, not comforted (12%)."},
{q:"Evaluate the Strange Situation.",m:6,p:"C1",ms:"Strengths and weaknesses",ma:"Strengths: Standardised, reliable classification. Weaknesses: Cultural bias (imposed etic), artificial, measures one relationship."}
],'Controversies':[
{q:"Explain cultural bias in psychology.",m:4,p:"C3",ms:"Definition, evidence",ma:"Research reflects culture's values. 96% participants from WEIRD societies. Ethnocentrism assumes Western norms universal."},
{q:"Explain emic and etic approaches.",m:4,p:"C3",ms:"Both defined with example",ma:"Emic: within culture concepts. Etic: universal concepts. Ainsworth's Strange Situation misinterpreted Japanese attachment."},
{q:"Discuss cultural bias.",m:16,p:"C3",ms:"Types, examples, solutions",ma:"Ethnocentrism, imposed etic, WEIRD sampling. Van Ijzendoorn found cultural variation. Solutions: indigenous psychologies, collaboration."},
{q:"Explain gender bias.",m:4,p:"C3",ms:"Definition and types",ma:"Research favouring one gender. Alpha bias: exaggerates differences. Beta bias: minimises. Androcentrism: male as norm."},
{q:"Discuss ethical issues in research.",m:12,p:"C3",ms:"Issues, examples, guidelines",ma:"Deception, consent, harm, withdrawal. Milgram, Zimbardo examples. BPS guidelines, cost-benefit analysis."},
{q:"Discuss free will vs determinism.",m:12,p:"C3",ms:"Both sides with examples",ma:"Determinism: behaviour has causes - biological, psychic, environmental. Free will: humanistic. Soft determinism: can choose to change."},
{q:"Discuss nature-nurture debate.",m:12,p:"C3",ms:"Both sides, interactionist",ma:"Nature: genes, brain. Nurture: environment. Twin studies show both. Interactionist: genes set potential, environment determines expression."}
]},
pe:{'Energy Systems':[
{q:"Describe the ATP-PC system.",m:4,p:"P1",ms:"Process, yield, duration",ma:"PC broken down by creatine kinase to resynthesise ATP. Anaerobic, 1 ATP, no fatiguing by-products, lasts 10 seconds."},
{q:"Analyse energy systems during 400m.",m:8,p:"P1",ms:"All 3 systems with timing",ma:"ATP-PC first 100m. Glycolytic 100-350m producing lactate. Aerobic ~15-20% throughout. All work simultaneously - continuum."},
{q:"Describe anaerobic glycolytic system.",m:4,p:"P1",ms:"Process, yield, by-products",ma:"Glycogen to pyruvic acid to lactic acid. 2 ATP per glucose. Dominant 10s-3min. Lactate causes fatigue."},
{q:"Explain EPOC.",m:6,p:"P1",ms:"Definition, components",ma:"Excess Post-exercise O2 Consumption. Fast: restores ATP/PC, re-saturates myoglobin. Slow: removes lactate, tissue repair."},
{q:"Explain energy continuum.",m:6,p:"P1",ms:"Concept with examples",ma:"All 3 systems work simultaneously. 100m: ATP-PC. 800m: mix. Marathon: aerobic but ATP-PC for sprint finish."},
{q:"Describe aerobic system stages.",m:6,p:"P1",ms:"Stages with yield",ma:"Glycolysis: 2 ATP. Krebs cycle: 2 ATP. ETC: 34 ATP. Total 38 ATP per glucose."},
{q:"Explain lactate threshold.",m:4,p:"P1",ms:"Definition, importance",ma:"Point where lactate production exceeds removal. OBLA at 4mmol/L. Training at threshold improves performance."},
{q:"Describe factors affecting recovery.",m:6,p:"P1",ms:"Multiple factors",ma:"Fitness level, intensity, type of recovery (active better), oxygen availability, cool-down, nutrition."},
{q:"Explain role of mitochondria.",m:4,p:"P1",ms:"Location, function",ma:"Site of aerobic respiration. Produce most ATP. Endurance training increases density."},
{q:"Compare energy systems.",m:8,p:"P1",ms:"All 3 compared",ma:"ATP-PC: fastest, 1 ATP, 10s. Glycolytic: fast, 2 ATP, fatiguing, 3min. Aerobic: slow, 38 ATP, unlimited."}
],'Cardiovascular System':[
{q:"Define cardiac output with formula.",m:4,p:"P1",ms:"Definition, formula, values",ma:"Volume pumped per minute. Q = HR √ó SV. Rest: 5 L/min. Exercise: up to 30-40 L/min."},
{q:"Describe cardiac conduction system.",m:6,p:"P1",ms:"Components, functions",ma:"SA node generates impulse. AV node delays. Bundle of His down septum. Purkinje fibres through ventricles."},
{q:"Explain Frank-Starling mechanism.",m:4,p:"P1",ms:"Mechanism, significance",ma:"Increased venous return stretches ventricles causing stronger contraction. Matches output to demand."},
{q:"Describe blood redistribution during exercise.",m:6,p:"P1",ms:"Vasodilation, vasoconstriction",ma:"Vascular shunt. Vasodilation to muscles (20% to 80%). Vasoconstriction to digestive system. Pre-capillary sphincters respond."},
{q:"Explain a-vO2 difference.",m:4,p:"P1",ms:"Definition, values",ma:"Difference between arterial and venous O2. Rest: 5ml/100ml. Exercise: 15ml. Trained athletes higher."},
{q:"Describe cardiovascular drift.",m:4,p:"P1",ms:"What happens, why",ma:"HR increases while SV decreases during prolonged exercise. Caused by fluid loss, blood to skin for cooling."},
{q:"Explain blood pressure changes.",m:4,p:"P1",ms:"Changes, mechanisms",ma:"Systolic increases, diastolic stable. MAP increases to drive blood to muscles."},
{q:"Describe blood vessel structure and function.",m:6,p:"P1",ms:"Arteries, veins, capillaries",ma:"Arteries: thick walls, high pressure. Veins: valves, low pressure. Capillaries: one cell thick for diffusion."}
],'Respiratory System':[
{q:"Define tidal volume, vital capacity, residual volume.",m:3,p:"P1",ms:"Correct definitions",ma:"TV: air in/out at rest. VC: max exhaled after max inhalation. RV: air remaining after max exhalation."},
{q:"Explain gaseous exchange at alveoli.",m:6,p:"P1",ms:"Process and adaptations",ma:"Diffusion down partial pressure gradients. Adaptations: thin walls, moist, large surface area, dense capillaries."},
{q:"Define minute ventilation.",m:4,p:"P1",ms:"Definition, formula, changes",ma:"Volume per minute. VE = TV √ó frequency. Rest: 6 L/min. Exercise: 150+ L/min."},
{q:"Describe breathing mechanics.",m:6,p:"P1",ms:"Inspiration, expiration",ma:"Inspiration: diaphragm contracts, intercostals raise ribs. Expiration: passive at rest, active during exercise."},
{q:"Explain oxygen transport.",m:4,p:"P1",ms:"Haemoglobin, dissociation",ma:"97% bound to haemoglobin. Dissociates where pO2 low. Bohr effect: more released when CO2/temp high."},
{q:"Describe altitude training effects.",m:6,p:"P1",ms:"Adaptations, benefits",ma:"Lower pO2 triggers more EPO, red blood cells, haemoglobin. Improved oxygen-carrying capacity."}
],'Biomechanics':[
{q:"Apply Newton's Laws to sprinting.",m:6,p:"P1",ms:"All 3 laws",ma:"1st: at rest until force. 2nd: F=ma. 3rd: push back on blocks, blocks push forward."},
{q:"Explain angular momentum in diving.",m:4,p:"P1",ms:"Conservation applied",ma:"L=Iœâ conserved. Tucking decreases I, increases œâ (faster spin). Extending slows rotation."},
{q:"Define moment of inertia.",m:4,p:"P1",ms:"Definition, factors",ma:"Resistance to rotation. I = Œ£mr¬≤. Mass further from axis = higher I = harder to rotate."},
{q:"Explain Bernoulli principle in sport.",m:4,p:"P1",ms:"Principle and application",ma:"Faster air has lower pressure. Creates lift on discus. Also explains swing in cricket."},
{q:"Calculate force: 75kg, 4m/s¬≤.",m:2,p:"P1",ms:"Correct answer",ma:"F = ma = 75 √ó 4 = 300 N"},
{q:"Calculate momentum: 0.45kg, 25m/s.",m:2,p:"P1",ms:"Correct answer",ma:"p = mv = 0.45 √ó 25 = 11.25 kg¬∑m/s"},
{q:"Explain projectile motion factors.",m:6,p:"P1",ms:"Speed, angle, height",ma:"Speed most important. Angle 37-42¬∞ for shot put. Height affects flight time."},
{q:"Calculate acceleration: 0 to 10m/s in 2s.",m:2,p:"P1",ms:"Correct answer",ma:"a = (v-u)/t = 10/2 = 5 m/s¬≤"},
{q:"Explain impulse in sprinting.",m:4,p:"P1",ms:"Definition, application",ma:"Impulse = F √ó t = change in momentum. Longer block contact = greater impulse."},
{q:"Describe Magnus effect.",m:4,p:"P1",ms:"Principle and example",ma:"Spinning ball creates pressure difference, curves in direction of spin. Topspin in tennis."},
{q:"Explain levers in the body.",m:6,p:"P1",ms:"Classes, example",ma:"First: fulcrum between (neck). Second: load between (calf raise). Third: effort between (bicep curl)."}
],'Sport Psychology':[
{q:"Describe Bandura's self-efficacy sources.",m:4,p:"P2",ms:"All 4 sources",ma:"Performance accomplishments, vicarious experience, verbal persuasion, emotional arousal."},
{q:"Explain inverted U theory.",m:4,p:"P2",ms:"Theory and variations",ma:"Performance increases with arousal to optimal, then decreases. Optimal varies by task complexity."},
{q:"Describe attribution theory.",m:6,p:"P2",ms:"Weiner's model, effects",ma:"Locus, stability, controllability. Winners attribute internally. Learned helplessness from stable internal failure."},
{q:"Evaluate goal setting.",m:8,p:"P2",ms:"SMARTER, types, evidence",ma:"SMARTER principles. Outcome, performance, process goals. Locke & Latham: 16% improvement."},
{q:"Explain intrinsic and extrinsic motivation.",m:4,p:"P2",ms:"Definitions, sustainability",ma:"Intrinsic: internal satisfaction. Extrinsic: external rewards. Intrinsic more sustainable."},
{q:"Describe arousal control techniques.",m:6,p:"P2",ms:"Increase/decrease methods",ma:"Decrease: breathing, relaxation, imagery. Increase: physical activation, energising imagery."},
{q:"Explain home advantage.",m:4,p:"P2",ms:"What it is, explanations",ma:"Teams win more at home. Crowd support, familiarity, no travel, referee bias."},
{q:"Describe team cohesion strategies.",m:6,p:"P2",ms:"Multiple strategies",ma:"Clear roles, shared goals, team building, communication, inclusive leadership."}
],'Skill Acquisition':[
{q:"Describe Fitts and Posner's stages.",m:6,p:"P2",ms:"All 3 stages",ma:"Cognitive: understanding, errors. Associative: practicing, refining. Autonomous: automatic."},
{q:"Explain positive and negative transfer.",m:4,p:"P2",ms:"Definitions with examples",ma:"Positive: tennis serve helps badminton clear. Negative: tennis hinders squash."},
{q:"Describe guidance types.",m:6,p:"P2",ms:"Types with use",ma:"Visual: demos. Verbal: instructions. Manual: physical support. Mechanical: equipment."},
{q:"Explain feedback types.",m:4,p:"P2",ms:"Types with application",ma:"KR: outcome. KP: technique. Intrinsic vs extrinsic. Beginners need KR, experts KP."},
{q:"Describe practice types.",m:6,p:"P2",ms:"Massed, distributed, whole, part",ma:"Massed: continuous. Distributed: rest intervals. Whole: complete skill. Part: breakdown."},
{q:"Explain schema theory.",m:6,p:"P2",ms:"What schemas are",ma:"Generalised motor programmes adapt. Recall schema: production. Recognition schema: evaluation. Variable practice develops schemas."},
{q:"Describe practice methods.",m:4,p:"P2",ms:"Fixed, variable, mental",ma:"Fixed: same conditions. Variable: changing conditions. Mental: visualisation supplements physical."}
],'Contemporary Issues':[
{q:"Evaluate commercialisation in sport.",m:8,p:"P3",ms:"Positives, negatives",ma:"Positives: TV revenue, facilities, exposure. Negatives: TV dictates fixtures, ticket prices, wealthy dominate."},
{q:"Discuss technology in sport.",m:8,p:"P3",ms:"Types, benefits, drawbacks",ma:"GPS, Hawk-Eye, equipment. Benefits: marginal gains, fairness. Drawbacks: expense, ethics."},
{q:"Discuss performance-enhancing drugs.",m:8,p:"P3",ms:"Arguments both sides",ma:"Against: health, unfair, role models. For: choice, hard to police. Banned for health and fairness."},
{q:"Explain globalisation's impact.",m:6,p:"P3",ms:"Positives and negatives",ma:"Positives: global audiences, investment. Negatives: talent drain, identity loss."},
{q:"Discuss Sport England and UK Sport roles.",m:6,p:"P3",ms:"Different roles",ma:"Sport England: grassroots participation. UK Sport: elite performance, Olympic funding."},
{q:"Explain Olympic impact on hosts.",m:6,p:"P3",ms:"Positives and negatives",ma:"Positives: infrastructure, tourism. Negatives: cost overruns, white elephants."},
{q:"Discuss equity in sport.",m:8,p:"P3",ms:"Barriers, solutions",ma:"Barriers: cost, discrimination, stereotypes. Solutions: funding, access, policies."}
]},
english:{'A Streetcar Named Desire':[
{q:"Analyse Williams's use of light symbolism.",m:6,p:"P2",ms:"AO2: analysis with examples",ma:"Light = truth. Blanche avoids it. Paper lantern beautifies reality. Stanley destroying lantern = destroying illusions."},
{q:"How does Williams present Stanley and Blanche's conflict?",m:8,p:"P2",ms:"AO2: techniques. AO3: context",ma:"Contrasting registers: Stanley direct, Blanche elaborate. Physical dominance vs retreat. Old South vs New America."},
{q:"Explore how Williams presents desire.",m:8,p:"P2",ms:"AO2: multiple levels",ma:"Sexual desire, security, illusion. Streetcars Desire to Cemeteries - destructive journey. Desire vital yet dangerous."},
{q:"Analyse Blanche's mental deterioration.",m:8,p:"P2",ms:"AO2: dramatic techniques",ma:"Varsouviana intrudes increasingly. Stage directions show decline. Language fragments. Climax through distorted sound."},
{q:"How does Williams present masculinity?",m:6,p:"P2",ms:"AO2: characterisation",ma:"Stanley: animalistic, territorial. Contrasts with Mitch, Allan. Critiques toxic masculinity. Post-war gender roles."},
{q:"Analyse the play's ending.",m:6,p:"P2",ms:"AO2: techniques",ma:"Kindness of strangers - irony. Poker continues. Stella's choice. Morally ambiguous."},
{q:"How does Williams use sound?",m:6,p:"P2",ms:"AO2: specific examples",ma:"Varsouviana: trauma. Blue piano: setting, desire. Locomotive: reality intrusion. Sound externalises psychology."},
{q:"Analyse Williams's stage directions.",m:6,p:"P2",ms:"AO2: functions",ma:"Unusually detailed. Describe lighting, sound, movement. Create expressionistic staging. Both practical and symbolic."},
{q:"How does Williams present Stella?",m:6,p:"P2",ms:"AO2: characterisation",ma:"Caught between sister and husband. Chooses passion over truth. Complicit in Blanche's destruction. Limited choices."},
{q:"Analyse Belle Reve's significance.",m:6,p:"P2",ms:"AO2: symbolism",ma:"Beautiful dream - ironic. Old South decline. Blanche's guilt. Stanley investigates - class conflict."}
],'Things Fall Apart':[
{q:"Analyse Achebe's narrative voice.",m:6,p:"P3",ms:"AO2: techniques. AO3: postcolonial",ma:"Third-person limited. Free indirect discourse. Igbo proverbs validate tradition. Final chapter shift enacts colonial violence."},
{q:"How does Achebe present Okonkwo's tragic flaw?",m:6,p:"P3",ms:"AO2: characterisation",ma:"Fear of weakness drives aggression. Personal tragedy and cultural critique. Rigid masculinity prevents adaptation."},
{q:"Analyse colonialism's impact.",m:8,p:"P3",ms:"AO2: techniques. AO3: essential",ma:"Gradual accumulation. Knife metaphor. Commissioner's title - narrative violence. Written in English reclaims language."},
{q:"Explore Achebe's use of proverbs.",m:6,p:"P3",ms:"AO2: effects",ma:"Create distinctive style. Validate wisdom tradition. Communal voice. Reclaim oral tradition."},
{q:"How does Achebe present gender?",m:6,p:"P3",ms:"AO2: examples",ma:"Violence normalised. But Earth goddess female. Ezinma's intelligence. Neither romanticises nor demonises."},
{q:"Analyse title and structure.",m:6,p:"P3",ms:"AO2: structure",ma:"Yeats reference - universal collapse. Three parts mirror fall. Makes readers invest before loss."},
{q:"How does Achebe present missionaries?",m:6,p:"P3",ms:"AO2: characterisation",ma:"Differentiated: Brown (accommodating) vs Smith (zealous). Appeal to outcasts. Shows complexity."},
{q:"Analyse Ikemefuna's death significance.",m:6,p:"P3",ms:"AO2: narrative",ma:"Okonkwo participates despite warning. Narrative distance. Psychological turning point. Nwoye's alienation."},
{q:"How does Achebe present Igbo religion?",m:6,p:"P3",ms:"AO2: presentation",ma:"Complex, sophisticated. Chi, egwugwu, Oracle. Ethical system. Equal validity implied."},
{q:"Analyse the novel's ending.",m:6,p:"P3",ms:"AO2: narrative shift",ma:"Shift to Commissioner. Okonkwo reduced to paragraph. Pacification ironic. Reader experiences colonial violence."}
],'Poetry Analysis':[
{q:"Analyse how poets use structure.",m:8,p:"P2",ms:"AO2: features. AO4: comparison",ma:"Stanzas: regular = control. Line length controls pace. Enjambment creates urgency. Volta for shifts."},
{q:"How do poets use imagery?",m:6,p:"P2",ms:"AO2: types",ma:"Metaphor creates equivalence. Extended metaphors develop. Simile maintains distinction. Sensory creates visceral response."},
{q:"Analyse foregrounding and deviation.",m:6,p:"P2",ms:"AO2: techniques",ma:"Making elements stand out. Lexical: unusual words. Grammatical: inverted syntax. Deviations signal significance."},
{q:"How do poets use sound?",m:6,p:"P2",ms:"AO2: techniques",ma:"Alliteration links words. Assonance: musicality. Sibilance: hissing. Plosives: harsh. Sound enacts meaning."},
{q:"Analyse how poets present time.",m:6,p:"P2",ms:"AO2: techniques",ma:"Tense shifts create immediacy. Temporal deixis positions reader. Structure mirrors time."},
{q:"How do poets use voice?",m:6,p:"P2",ms:"AO2: effects",ma:"Persona not necessarily poet. Direct address creates intimacy. Shifts signal change. Dramatic monologue reveals."}
],'Non-fiction Analysis':[
{q:"Analyse language in non-fiction.",m:8,p:"P1",ms:"AO1: terminology. AO2: effects",ma:"Register affects relationship. Lexical choices, semantic fields. Rhetorical devices. Pronoun use."},
{q:"Define three linguistic terms.",m:6,p:"P1",ms:"2 marks per term",ma:"Semantic field: related words. Deixis: pointing words. Modality: certainty through modal verbs."},
{q:"How do writers establish credibility?",m:6,p:"P1",ms:"AO2: techniques",ma:"Expert testimony, statistics, personal experience. Ethos, logos, pathos. Formal register."},
{q:"How do writers appeal to emotions?",m:6,p:"P1",ms:"AO2: techniques",ma:"Emotive lexis, anecdotes, direct address, rhetorical questions, imagery."},
{q:"Analyse context's role.",m:6,p:"P1",ms:"AO3: production, reception",ma:"When/where written, purpose, author. Audience, historical context. Mode shapes conventions."}
],'Creative Writing':[
{q:"Write narrative opening about discovery (500 words).",m:24,p:"P3",ms:"AO5: creativity, voice, structure",ma:"Controlled voice, effective hook, sentence variety, showing not telling, sensory detail."},
{q:"Write commentary on creative piece.",m:8,p:"P3",ms:"AO2: analysis with terminology",ma:"Precise terminology, explain choices, analyse effects. Show understanding of craft."},
{q:"Write descriptive piece from photograph.",m:24,p:"P3",ms:"AO5: descriptive techniques",ma:"Sensory detail, figurative language, varied sentences, mood, perspective."},
{q:"Write story opening in specific genre.",m:24,p:"P3",ms:"AO5: genre conventions",ma:"Genre awareness, establish tone/setting/character, hook reader, balance convention and subversion."}
]}};

function expandQ(q){return{question:q.q,marks:q.m,paper:q.p,markScheme:q.ms,modelAnswer:q.ma};}
const questionBankFull={};
for(const s in Q){questionBankFull[s]={};for(const t in Q[s]){questionBankFull[s][t]=Q[s][t].map(expandQ);}}

let history=[];
let stats={attempted:0,totalMarks:0,totalPossible:0,lastAttemptDate:null,streak:0};
let currentSubject='psychology';
let currentQuestion=null;

function loadData(){
    const h=localStorage.getItem('revisionHistoryV5');
    if(h)history=JSON.parse(h);
    const s=localStorage.getItem('revisionStatsV5');
    if(s)stats=JSON.parse(s);
    updateStatsDisplay();
    if(localStorage.getItem('claudeApiKey'))document.getElementById('apiKeySection').style.display='none';
    document.getElementById('totalQuestions').textContent=countQuestions();
}

function saveData(){
    localStorage.setItem('revisionHistoryV5',JSON.stringify(history));
    localStorage.setItem('revisionStatsV5',JSON.stringify(stats));
    updateStatsDisplay();
}

function countQuestions(){
    let t=0;
    for(const s in questionBankFull)for(const tp in questionBankFull[s])t+=questionBankFull[s][tp].length;
    return t;
}

function updateStatsDisplay(){
    const today=new Date().toDateString();
    document.getElementById('questionsToday').textContent=history.filter(h=>new Date(h.date).toDateString()===today).length;
    document.getElementById('questionsTotal').textContent=stats.attempted;
    if(stats.totalPossible>0)document.getElementById('averageMark').textContent=Math.round(stats.totalMarks/stats.totalPossible*100)+'%';
    document.getElementById('streak').textContent=stats.streak||0;
}

function saveApiKey(){
    const k=document.getElementById('apiKey').value.trim();
    if(k.startsWith('sk-ant-')){localStorage.setItem('claudeApiKey',k);document.getElementById('apiKeySection').style.display='none';alert('Saved!');}
    else alert('Invalid key');
}

function showTab(tab){
    document.querySelectorAll('.nav-tab').forEach(t=>t.classList.remove('active'));
    event.target.classList.add('active');
    if(tab==='practice'){
        document.getElementById('practiceTab').style.display='block';
        document.getElementById('progressTab').classList.remove('visible');
        document.getElementById('questionSection').classList.remove('hidden');
        document.getElementById('feedbackSection').classList.remove('visible');
    }else{
        document.getElementById('practiceTab').style.display='none';
        document.getElementById('questionSection').classList.add('hidden');
        document.getElementById('feedbackSection').classList.remove('visible');
        document.getElementById('progressTab').classList.add('visible');
        updateProgressView();
    }
}

function updateProgressView(){
    ['psychology','pe','english'].forEach(s=>{
        const sh=history.filter(h=>h.subject===s);
        if(sh.length>0){
            const avg=Math.round(sh.reduce((sum,h)=>sum+h.mark/h.maxMark*100,0)/sh.length);
            document.getElementById(s==='psychology'?'psychAvg':s==='pe'?'peAvg':'engAvg').textContent=avg+'%';
            if(sh.length>=10){
                const recent=sh.slice(-5).reduce((sum,h)=>sum+h.mark/h.maxMark,0)/5;
                const prev=sh.slice(-10,-5).reduce((sum,h)=>sum+h.mark/h.maxMark,0)/5;
                const trend=recent>prev?'‚Üë Improving':recent<prev?'‚Üì Declining':'‚Üí Stable';
                document.getElementById(s==='psychology'?'psychTrend':s==='pe'?'peTrend':'engTrend').innerHTML='<span class="'+(recent>prev?'trend-up':recent<prev?'trend-down':'')+'">'+trend+'</span>';
            }
        }
    });
    
    const wc=document.getElementById('weeklyChart');wc.innerHTML='';
    const days=[];for(let i=6;i>=0;i--){const d=new Date();d.setDate(d.getDate()-i);days.push(d);}
    const maxQ=Math.max(...days.map(d=>history.filter(h=>new Date(h.date).toDateString()===d.toDateString()).length),1);
    days.forEach(d=>{
        const c=history.filter(h=>new Date(h.date).toDateString()===d.toDateString()).length;
        const bar=document.createElement('div');bar.className='chart-bar';bar.style.height=(c>0?c/maxQ*100:5)+'%';
        bar.innerHTML='<span class="chart-bar-value">'+c+'</span><span class="chart-bar-label">'+d.toLocaleDateString('en-GB',{weekday:'short'})+'</span>';
        wc.appendChild(bar);
    });
    
    const tb=document.getElementById('topicBreakdown');tb.innerHTML='';
    const ts={};history.forEach(h=>{const k=h.subject+'|'+h.topic;if(!ts[k])ts[k]={marks:0,maxMarks:0};ts[k].marks+=h.mark;ts[k].maxMarks+=h.maxMark;});
    const sorted=Object.entries(ts).sort((a,b)=>a[1].marks/a[1].maxMarks-b[1].marks/b[1].maxMarks);
    if(sorted.length===0)tb.innerHTML='<div class="no-data">Complete questions to see topics</div>';
    else sorted.slice(0,10).forEach(([k,d])=>{
        const pct=Math.round(d.marks/d.maxMarks*100);
        const row=document.createElement('div');row.className='topic-row';
        row.innerHTML='<span class="topic-name">'+k.split('|')[1]+'</span><div class="topic-bar-container"><div class="topic-bar '+(pct>=70?'good':pct>=50?'ok':'low')+'" style="width:'+pct+'%"></div></div><span class="topic-score">'+pct+'%</span>';
        tb.appendChild(row);
    });
    
    const ht=document.getElementById('historyTable');
    if(history.length===0)ht.innerHTML='<div class="no-data">No sessions yet</div>';
    else{
        let html='<table class="history-table"><thead><tr><th>Date</th><th>Subject</th><th>Topic</th><th>Score</th></tr></thead><tbody>';
        history.slice(-15).reverse().forEach(h=>{
            const pct=Math.round(h.mark/h.maxMark*100);
            html+='<tr><td>'+new Date(h.date).toLocaleDateString('en-GB',{day:'numeric',month:'short'})+'</td><td>'+h.subject+'</td><td>'+h.topic+'</td><td class="'+(pct>=70?'score-good':pct>=50?'score-ok':'score-low')+'">'+pct+'%</td></tr>';
        });
        ht.innerHTML=html+'</tbody></table>';
    }
}

function exportData(){
    if(!history.length){alert('No data');return;}
    let csv='Date,Subject,Topic,Mark,MaxMark,Percentage\n';
    history.forEach(h=>{csv+=new Date(h.date).toLocaleDateString('en-GB')+','+h.subject+','+h.topic+','+h.mark+','+h.maxMark+','+Math.round(h.mark/h.maxMark*100)+'\n';});
    const a=document.createElement('a');a.href='data:text/csv;charset=utf-8,'+encodeURIComponent(csv);a.download='revision_progress.csv';a.click();
}

function selectSubject(subject){
    currentSubject=subject;
    document.querySelectorAll('.subject-btn').forEach(b=>b.classList.remove('active'));
    document.querySelector('.subject-btn.'+subject).classList.add('active');
    const sel=document.getElementById('topicSelect');
    sel.innerHTML='<option value="">Select topic...</option><option value="random">üé≤ Random</option><option value="weak">üéØ Weak topics</option>';
    Object.keys(questionBankFull[subject]).forEach(t=>{
        const o=document.createElement('option');o.value=t;o.textContent=t+' ('+questionBankFull[subject][t].length+')';sel.appendChild(o);
    });
}

function loadQuestion(){
    const v=document.getElementById('topicSelect').value;if(!v)return;
    let qs,topic;
    if(v==='random'){const ts=Object.keys(questionBankFull[currentSubject]);topic=ts[Math.floor(Math.random()*ts.length)];qs=questionBankFull[currentSubject][topic];}
    else if(v==='weak'){
        const sc={};history.filter(h=>h.subject===currentSubject).forEach(h=>{if(!sc[h.topic])sc[h.topic]={m:0,mx:0};sc[h.topic].m+=h.mark;sc[h.topic].mx+=h.maxMark;});
        const w=Object.entries(sc).sort((a,b)=>a[1].m/a[1].mx-b[1].m/b[1].mx)[0];
        topic=w?w[0]:Object.keys(questionBankFull[currentSubject])[0];qs=questionBankFull[currentSubject][topic];
    }else{topic=v;qs=questionBankFull[currentSubject][topic];}
    currentQuestion=qs[Math.floor(Math.random()*qs.length)];currentQuestion._topic=topic;
    document.getElementById('questionMarks').textContent='['+currentQuestion.marks+' marks]';
    document.getElementById('paperTag').textContent=currentQuestion.paper;
    document.getElementById('questionText').textContent=currentQuestion.question;
    document.getElementById('answerInput').value='';document.getElementById('wordCount').textContent='0';
    document.getElementById('feedbackSection').classList.remove('visible');
    document.getElementById('questionSection').classList.remove('hidden');
}

document.getElementById('answerInput').addEventListener('input',function(){document.getElementById('wordCount').textContent=this.value.trim().split(/\s+/).filter(w=>w).length;});

async function submitAnswer(){
    const ans=document.getElementById('answerInput').value.trim();
    if(!ans){alert('Write an answer!');return;}
    document.getElementById('questionSection').classList.add('hidden');
    document.getElementById('loadingSection').classList.remove('hidden');
    let fb;
    try{const k=localStorage.getItem('claudeApiKey');fb=k?await getAIFeedback(ans,k):simulateFeedback(ans);}catch(e){fb=simulateFeedback(ans);}
    displayFeedback(fb);
    history.push({date:new Date().toISOString(),subject:currentSubject,topic:currentQuestion._topic,question:currentQuestion.question,mark:fb.mark,maxMark:currentQuestion.marks});
    stats.attempted++;stats.totalMarks+=fb.mark;stats.totalPossible+=currentQuestion.marks;
    const today=new Date().toDateString();
    if(stats.lastAttemptDate!==today){stats.streak=stats.lastAttemptDate===new Date(Date.now()-86400000).toDateString()?stats.streak+1:1;stats.lastAttemptDate=today;}
    saveData();
    document.getElementById('loadingSection').classList.add('hidden');
    document.getElementById('feedbackSection').classList.add('visible');
}

async function getAIFeedback(ans,key){
    const p='Mark this A-Level answer. QUESTION: '+currentQuestion.question+' MARKS: '+currentQuestion.marks+' MARK SCHEME: '+currentQuestion.markScheme+' MODEL: '+currentQuestion.modelAnswer+' ANSWER: '+ans+' Reply JSON only: {"mark":N,"strengths":["..."],"improvements":["..."],"missingPoints":["..."],"overallComment":"..."}';
    const r=await fetch('https://api.anthropic.com/v1/messages',{method:'POST',headers:{'Content-Type':'application/json','x-api-key':key,'anthropic-version':'2023-06-01','anthropic-dangerous-direct-browser-access':'true'},body:JSON.stringify({model:'claude-sonnet-4-20250514',max_tokens:1024,messages:[{role:'user',content:p}]})});
    const d=await r.json();const m=d.content[0].text.match(/\{[\s\S]*\}/);return m?JSON.parse(m[0]):simulateFeedback(ans);
}

function simulateFeedback(ans){
    const wc=ans.split(/\s+/).length,low=ans.toLowerCase();
    const ev=/research|study|found|\d{4}/.test(low),eval=/however|strength|weakness/.test(low),ex=/example|e\.g\./.test(low);
    let mark=0;const max=currentQuestion.marks;
    if(wc>30)mark+=max*0.15;if(wc>60)mark+=max*0.1;if(ev)mark+=max*0.2;if(eval)mark+=max*0.2;if(ex)mark+=max*0.1;
    mark=Math.min(Math.round(mark),max);
    const str=[],imp=[];
    if(wc>50)str.push('Good detail');if(ev)str.push('Included evidence');if(eval)str.push('Showed evaluation');if(ex)str.push('Used examples');
    if(!ev)imp.push('Add research evidence');if(!eval&&max>=6)imp.push('Add evaluation');if(wc<50)imp.push('More detail needed');
    if(!str.length)str.push('Good attempt!');
    return{mark,strengths:str,improvements:imp.slice(0,3),missingPoints:['See model answer'],overallComment:'Basic marking - add API key for AI feedback'};
}

function displayFeedback(fb){
    document.getElementById('markAwarded').textContent=fb.mark;
    document.getElementById('markTotal').textContent=currentQuestion.marks;
    const pct=fb.mark/currentQuestion.marks*100;
    const gi=document.getElementById('gradeIndicator');gi.className='grade-indicator';
    if(pct>=80){gi.textContent='Grade A ‚≠ê';gi.classList.add('grade-a');}
    else if(pct>=70){gi.textContent='Grade B';gi.classList.add('grade-b');}
    else if(pct>=60){gi.textContent='Grade C';gi.classList.add('grade-c');}
    else if(pct>=50){gi.textContent='Grade D';gi.classList.add('grade-d');}
    else{gi.textContent='Keep Practicing';gi.classList.add('grade-e');}
    document.getElementById('strengthsFeedback').innerHTML='<ul>'+fb.strengths.map(s=>'<li>'+s+'</li>').join('')+'</ul>'+(fb.overallComment?'<p style="margin-top:10px;font-style:italic">'+fb.overallComment+'</p>':'');
    document.getElementById('improvementsFeedback').innerHTML='<ul>'+fb.improvements.map(i=>'<li>'+i+'</li>').join('')+'</ul>';
    document.getElementById('modelPointsFeedback').innerHTML='<ul>'+fb.missingPoints.map(p=>'<li>'+p+'</li>').join('')+'</ul>';
    document.getElementById('markSchemeContent').innerHTML='<p><b>Mark Scheme:</b> '+currentQuestion.markScheme+'</p><p style="margin-top:15px"><b>Model Answer:</b> '+currentQuestion.modelAnswer+'</p>';
}

function nextQuestion(){
    document.getElementById('feedbackSection').classList.remove('visible');
    document.getElementById('questionSection').classList.remove('hidden');
    loadQuestion();
}

loadData();selectSubject('psychology');
</script>
</body>
</html>
